# WAV (Waveform Audio File Format) - RIFF Container
# Specification: Multimedia Programming Interface and Data Specifications 1.0
# Purpose: Parsing WAV file RIFF header, fmt chunk, and data chunk locations
#
# WAV is an uncompressed PCM audio format using the RIFF (Resource Interchange File Format) container.
# Structure: RIFF Header + fmt Chunk + (optional chunks) + data Chunk
#
# Reference: http://www-mmsp.ece.mcgill.ca/Documents/AudioFormats/WAVE/WAVE.html
# MIME type: audio/wav, audio/wave

name: WAV (RIFF WAVE) Audio Header
description: |
  WAV/RIFF file header with format chunk (fmt) containing sample rate,
  bit depth, channels, and audio format. Includes data chunk location.
endian: little  # RIFF uses little-endian for chunk sizes and data

fields:
  # ============================================================================
  # RIFF Chunk Descriptor - 12 bytes
  # ============================================================================
  
  - name: chunk_id
    offset: 0x00
    size: 4
    type: hex_string
    description: "RIFF chunk identifier: 'RIFF' in ASCII"
    assert: "52494646"
    
  - name: chunk_size
    offset: 0x04
    size: 4
    type: u32
    description: "File size minus 8 bytes (chunk_id + chunk_size)"
    display: hex
    
  - name: format
    offset: 0x08
    size: 4
    type: hex_string
    description: "RIFF format type: 'WAVE' in ASCII"
    assert: "57415645"

  # ============================================================================
  # fmt Sub-chunk (Format Chunk) - 24 bytes minimum (16 for PCM, more for others)
  # ============================================================================

  - name: subchunk1_id
    offset: 0x0C
    size: 4
    type: hex_string
    description: "Format chunk identifier: 'fmt ' in ASCII (note trailing space)"
    assert: "666d7420"
    
  - name: subchunk1_size
    offset: 0x10
    size: 4
    type: u32
    description: "Size of fmt chunk data (16 for PCM, 18+ for compressed)"
    
  - name: audio_format
    offset: 0x14
    size: 2
    type: u16
    description: "Audio format code"
    enum:
      1: "PCM (Uncompressed linear quantization)"
      2: "Microsoft ADPCM"
      3: "IEEE Float"
      6: "A-law"
      7: "Î¼-law (mu-law)"
      17: "IMA ADPCM"
      20: "ITU G.723 ADPCM (Yamaha)"
      49: "GSM 6.10"
      64: "ITU G.721 ADPCM"
      80: "MPEG"
      65534: "WAVE_FORMAT_EXTENSIBLE (Subformat in extension)"
    
  - name: num_channels
    offset: 0x16
    size: 2
    type: u16
    description: "Number of audio channels"
    enum:
      1: "Mono"
      2: "Stereo"
      4: "Quadraphonic"
      6: "5.1 Surround"
      8: "7.1 Surround"
    
  - name: sample_rate
    offset: 0x18
    size: 4
    type: u32
    description: "Sample rate in Hz (e.g., 44100, 48000, 96000)"
    
  - name: byte_rate
    offset: 0x1C
    size: 4
    type: u32
    description: "Bytes per second (sample_rate * num_channels * bits_per_sample / 8)"
    
  - name: block_align
    offset: 0x20
    size: 2
    type: u16
    description: "Bytes per sample frame (num_channels * bits_per_sample / 8)"
    
  - name: bits_per_sample
    offset: 0x22
    size: 2
    type: u16
    description: "Bits per sample (8, 16, 24, 32 common for PCM)"
    enum:
      8: "8-bit unsigned PCM"
      16: "16-bit signed PCM"
      24: "24-bit signed PCM"
      32: "32-bit signed PCM or IEEE float"

  # ============================================================================
  # Extension for non-PCM formats (if subchunk1_size > 16)
  # ============================================================================
  
  # - name: extension_size (offset 0x24, size 2, type u16)
  #   Size of extension data (0 for PCM)
  # - name: extension_data (offset 0x26, variable size)
  #   Format-specific extension data

  # ============================================================================
  # data Sub-chunk - Offset varies based on fmt chunk size and other chunks
  # For standard PCM WAV, typically at offset 0x24 + subchunk1_size
  # Assuming PCM with 16-byte fmt chunk, data chunk starts at 0x24
  # ============================================================================

  - name: subchunk2_id
    offset: 0x24
    size: 4
    type: hex_string
    description: "Data chunk identifier: 'data' in ASCII"
    # Note: Other chunks (fact, LIST, etc.) may appear before data chunk
    
  - name: subchunk2_size
    offset: 0x28
    size: 4
    type: u32
    description: "Size of audio data in bytes"
    display: hex

  # ============================================================================
  # Audio Data - Offset 0x2C for standard PCM WAV
  # Raw PCM samples follow, format determined by fmt chunk parameters
  # ============================================================================

  # ============================================================================
  # Optional chunks that may appear:
  # - fact: Required for non-PCM formats, contains sample count
  # - cue : Cue point markers for navigation
  # - plst: Playlist segment list
  # - LIST: Embedded metadata (INFO list with INAM, IART, ICOP, etc.)
  # - JUNK: Padding for alignment
  # ============================================================================
