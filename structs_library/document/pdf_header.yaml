# PDF (Portable Document Format) File Format
# Specification: PDF Reference, Sixth Edition (PDF 1.7)
# Purpose: Parsing PDF file header and structure pointers
#
# PDF is a document format supporting text, graphics, fonts, and interactive forms.
# Structure: Header + Body (objects) + Cross-reference table + Trailer
#
# Reference: https://opensource.adobe.com/dc-acrobat-sdk-docs/pdfstandards/PDF32000_2008.pdf
# MIME type: application/pdf

name: PDF Document Header
description: |
  PDF file header with version identifier. PDFs use incremental updates,
  so file parsing requires reading from the end (xref table and trailer).
endian: big  # PDF uses ASCII/binary, conceptually big-endian for numbers

fields:
  # ============================================================================
  # PDF Header - Minimum 9 bytes, typically first line of file
  # Format: %PDF-X.Y where X.Y is version (1.0 through 1.7, or 2.0)
  # ============================================================================
  
  - name: pdf_signature
    offset: 0x00
    size: 5
    type: hex_string
    description: "PDF signature: '%PDF-' in ASCII"
    assert: "255044462d"
    
  - name: version_major
    offset: 0x05
    size: 1
    type: u8
    description: "PDF major version (ASCII digit: '1' or '2')"
    enum:
      49: "'1' - PDF 1.x"
      50: "'2' - PDF 2.0"
    
  - name: version_separator
    offset: 0x06
    size: 1
    type: hex_string
    description: "Version separator: '.' (period)"
    assert: "2e"
    
  - name: version_minor
    offset: 0x07
    size: 1
    type: u8
    description: "PDF minor version (ASCII digit: 0-9)"
    enum:
      48: "'0' - PDF 1.0 or 2.0"
      49: "'1' - PDF 1.1"
      50: "'2' - PDF 1.2"
      51: "'3' - PDF 1.3"
      52: "'4' - PDF 1.4"
      53: "'5' - PDF 1.5"
      54: "'6' - PDF 1.6"
      55: "'7' - PDF 1.7"
    
  - name: header_newline
    offset: 0x08
    size: 1
    type: hex_string
    description: "Line ending: CR, LF, or CRLF (typically LF=0x0A)"
    # 0x0A (LF) or 0x0D (CR) or 0x0D0A (CRLF)

  # ============================================================================
  # Binary Marker (optional, recommended) - Second line of header
  # Four bytes with high-bit set to mark file as binary for FTP, etc.
  # Typically: %âãÏÓ (25 E2 E3 CF D3) as comment
  # Format: % followed by 4 bytes >= 0x80
  # ============================================================================

  # Note: Cannot parse at fixed offset due to variable newline (1 or 2 bytes)
  # Typically at offset 0x09 or 0x0A

  # ============================================================================
  # PDF Body - Objects (variable offsets)
  # ============================================================================
  
  # PDF objects start after header, format:
  #   N M obj
  #   <object data>
  #   endobj
  #
  # Where N=object number, M=generation number
  #
  # Object types:
  #   Dictionary: << /Key1 Value1 /Key2 Value2 >>
  #   Array: [ item1 item2 ... ]
  #   Name: /Name
  #   String: (literal) or <hex>
  #   Number: 42 or 3.14
  #   Boolean: true or false
  #   Null: null
  #   Stream: dictionary followed by "stream\n<data>\nendstream"
  #
  # Common objects:
  #   Catalog (root): /Type /Catalog, /Pages reference
  #   Pages: /Type /Pages, /Kids array, /Count number
  #   Page: /Type /Page, /Parent, /MediaBox, /Contents, /Resources
  #   Content Stream: Contains PDF operators (text, graphics)
  #   Font: /Type /Font, /Subtype, /BaseFont
  #   Image (XObject): /Type /XObject, /Subtype /Image

  # ============================================================================
  # Cross-Reference Table (xref) - Located near end of file
  # ============================================================================
  
  # Location: Found by reading from end of file and finding "startxref"
  # Format:
  #   xref
  #   0 N
  #   OOOOOOOOOO GGGGG n/f
  #   ...
  #
  # Where:
  #   N = number of entries
  #   OOOOOOOOOO = 10-digit byte offset
  #   GGGGG = 5-digit generation number
  #   n/f = 'n' (in use) or 'f' (free)

  # ============================================================================
  # Trailer - Immediately follows xref table
  # ============================================================================
  
  # Format:
  #   trailer
  #   << /Size N /Root R /Info I /ID [<id1> <id2>] >>
  #   startxref
  #   OFFSET
  #   %%EOF
  #
  # Where:
  #   /Size = Total number of entries in xref table
  #   /Root = Reference to catalog object (N M R)
  #   /Info = Reference to document info dictionary (optional)
  #   /ID = File identifier array (optional but recommended)
  #   OFFSET = Byte offset of xref table
  #
  # %%EOF marks the end of PDF (may be followed by incremental updates)

  # ============================================================================
  # Linearized PDFs (Fast Web View)
  # ============================================================================
  
  # Linearized PDFs have a special first object (linearization dictionary)
  # immediately after header, enabling page-at-a-time web display.
  # Linearization dict: << /Linearized 1.0 /L <file length> /O <first page obj> >>

  # ============================================================================
  # Incremental Updates
  # ============================================================================
  
  # PDFs can have multiple body/xref/trailer sections appended.
  # Each trailer has /Prev pointing to previous xref offset.
  # Parse by starting at last %%EOF and following /Prev chain.

  # ============================================================================
  # Encrypted PDFs
  # ============================================================================
  
  # Trailer contains /Encrypt reference to encryption dictionary.
  # Encryption dict: /Filter /Standard, /V (version), /R (revision),
  #                  /O (owner password), /U (user password), /P (permissions)

  # ============================================================================
  # Note: PDF is a complex format requiring full parser for proper reading.
  # This template shows only the fixed header structure.
  # Body, xref, and trailer offsets are variable and must be parsed sequentially.
  # ============================================================================
